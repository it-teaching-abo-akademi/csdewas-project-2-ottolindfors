(this["webpackJsonpmy-react-app"]=this["webpackJsonpmy-react-app"]||[]).push([[0],{180:function(e,t,a){e.exports=a(371)},185:function(e,t,a){},187:function(e,t,a){},371:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(33),l=a.n(r),s=(a(185),a(28)),c=a.n(s),i=a(9),h=a(10),u=a(12),d=a(11),p=a(7),m=a(13),f=(a(187),"Tpk_564e31a7cc054b8c87a93c668202adce"),g="https://sandbox.iexapis.com/stable/stock/market/batch?",v="https://sandbox.iexapis.com/stable/stock/";var b=function(e,t,a){return function(e,t,a){var n=g;n+="symbols=";for(var o=0;o<e.length;o++)n+=e[o],o<e.length-1&&(n+=",");return n+="&types="+t,t.includes("chart")&&(n+=a?"&range="+a:"&range=1y"),n+="&token="+f}(e,t,a)},k=function(e,t){return function(e,t){var a=v;return a+=e,a+="/chart/date/",a+=t,a+="?chartByDay=true&token=",a+=f}(e,t)};function E(e){var t=new Date(e),a=new Date,n=Math.ceil((a-t)/864e5),o=new Date((new Date).toISOString().slice(0,4)),r=Math.ceil((a-o)/864e5),l="";return n<5?(l="5d",r<5&&(l="ytd")):n<32?(l="1m",r<32&&(l="ytd")):n<94?(l="3m",r<94&&(l="ytd")):n<168?(l="6m",r<168&&(l="ytd")):n<367?(l="1y",r<367&&(l="ytd")):l=n<732?"2y":n<1828?"5y":"max",l}function y(e,t){return e.name<t.name?-1:e.name>t.name?1:0}var w=function(e){return function(e){var t=JSON.parse(localStorage.getItem(e));if(!t)throw new Error("Did not find '"+e+"' in local storage");return t}(e)},S=function(e,t){return function(e,t){localStorage.setItem(t,JSON.stringify(e)),console.log("==> Saved to local storage '"+t+"'")}(e,t)},O=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={newPortfolioName:"",inputError:"",submitError:""},a.handleOnSubmit=a.handleOnSubmit.bind(Object(p.a)(a)),a.handleOnChange=a.handleOnChange.bind(Object(p.a)(a)),a.handleOnCancel=a.handleOnCancel.bind(Object(p.a)(a)),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleOnSubmit",value:function(e){e.preventDefault();var t=this.props.portfolios,a=this.state.newPortfolioName;t.includes(a)?this.setState({submitError:"Pick another name for your portfolio"}):(this.setState({newPortfolioName:"",submitError:""}),this.props.onAdd(a))}},{key:"handleOnChange",value:function(e){var t=this.props.portfolios,a=e.target.value;t.includes(a)?this.setState({newPortfolioName:e.target.value,inputError:"You have another portfolio with this name"}):this.setState({newPortfolioName:e.target.value,inputError:"",submitError:""})}},{key:"handleOnCancel",value:function(){this.setState({newPortfolioName:"",inputError:"",submitError:""}),this.props.onCancel()}},{key:"render",value:function(){return this.props.show?o.a.createElement("div",null,o.a.createElement("p",null,"Modal visible"),o.a.createElement("form",{onSubmit:this.handleOnSubmit},o.a.createElement("label",null,"Portfolio name",o.a.createElement("input",{type:"text",value:this.state.newPortfolioName,onChange:this.handleOnChange,required:!0})),o.a.createElement("p",null,this.state.inputError),o.a.createElement("p",null,this.state.submitError),o.a.createElement("input",{type:"submit",value:"Add"}),o.a.createElement("button",{onClick:this.handleOnCancel},"Cancel"))):o.a.createElement("p",null,"Modal hidden")}}]),t}(o.a.Component),D=a(21),C=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"generateHslColor",value:function(){return"hsl("+(360*Math.random()).toFixed(0).toString()+",40%,70%)"}},{key:"graphRangeToDate",value:function(e){if(e.includes("d")){var t=e.replace("d",""),a=new Date;return new Date((new Date).setDate(a.getDate()-t))}if(e.includes("m")){var n=e.replace("m",""),o=new Date;return new Date((new Date).setMonth(o.getMonth()-n))}if(e.includes("ytd"))return new Date((new Date).toISOString().slice(0,4));if(e.includes("y")){var r=e.replace("y",""),l=new Date;return new Date((new Date).setFullYear(l.getFullYear()-r))}if(e.includes("max")){var s=new Date;return new Date((new Date).setFullYear(s.getFullYear()-500))}}},{key:"render",value:function(){var e=this,t=this.props.stocks,a=this.props.graphRange,n=this.props.showInEuro,r=this.props.euroPerUsd,l=[],s=[],c=[],i=this.graphRangeToDate(a);for(var h in t)if(t.hasOwnProperty(h)){c.push(h);var u=t[h].chart;for(var d in u)if(u.hasOwnProperty(d)){var p=0;p=n?Number((u[d].close*r).toFixed(2)):u[d].close;var m=u[d].date;if(new Date(m)>=i)if(s.includes(m)){var f=s.indexOf(m),g=l[f];g[h]=p,l[f]=g}else{s.push(m);var v={};v.name=m,v[h]=p,l.push(v)}}}return l.sort(y),o.a.createElement("div",null,o.a.createElement(D.e,{aspect:1.7,width:500},o.a.createElement(D.d,{width:"100%",height:"100%",data:l},o.a.createElement(D.a,{strokeDasharray:"1 3"}),o.a.createElement(D.g,{dataKey:"name"}),o.a.createElement(D.h,null),o.a.createElement(D.f,null),o.a.createElement(D.b,null),c.map((function(t){return o.a.createElement(D.c,{key:t,dataKey:t,stroke:e.generateHslColor(),activeDot:{r:4},dot:!1})})))))}}]),t}(o.a.PureComponent),j=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleCheckedChange=a.handleCheckedChange.bind(Object(p.a)(a)),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleCheckedChange",value:function(e){this.props.onRowCheckedChange(e)}},{key:"render",value:function(){var e=this.props.stock,t=this.props.stockInfo,a=this.props.showInEuro,n=this.props.euroPerUsd,r=this.props.checked,l=t.quote.latestPrice,s=t.purchase.shares,c=t.purchase.price,i=t.purchase.currency;return o.a.createElement("tr",null,o.a.createElement("td",null,e),o.a.createElement("td",null,a?(l*n).toFixed(2)+" EUR":l+" USD"),o.a.createElement("td",null,c," ",i),o.a.createElement("td",null,s),o.a.createElement("td",null,a?(l*s*n).toFixed(2)+" EUR":(l*s).toFixed(2)+" USD"),o.a.createElement("td",null,o.a.createElement("input",{name:e,type:"checkbox",checked:r,onChange:this.handleCheckedChange})))}}]),t}(o.a.Component),P=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){this.props.selections;return o.a.createElement("button",null,"Remove selected stocks")}}]),t}(o.a.Component),A=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={selectedRows:[]},a.handleRowCheckedChange=a.handleRowCheckedChange.bind(Object(p.a)(a)),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.stocks,t=[];for(var a in e)e.hasOwnProperty(a)&&(t[a]=!1);this.setState({selectedRows:t})}},{key:"handleRowCheckedChange",value:function(e){var t=e.target.name,a=e.target.checked,n=this.state.selectedRows;n[t]=a,this.setState({selectedRows:n})}},{key:"render",value:function(){var e=this.props.stocks,t=this.props.showInEuro,a=this.props.euroPerUsd,n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(o.a.createElement(j,{key:r,stock:r,stockInfo:e[r],showInEuro:t,euroPerUsd:a,checked:!!this.state.selectedRows[r],onRowCheckedChange:this.handleRowCheckedChange}));return o.a.createElement("div",null,o.a.createElement(P,{selections:this.state.selections}),o.a.createElement("table",null,o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Stock"),o.a.createElement("th",null,"Latest Price"),o.a.createElement("th",null,"Purchase Price"),o.a.createElement("th",null,"Shares"),o.a.createElement("th",null,"Total"),o.a.createElement("th",null,"Select"))),o.a.createElement("tbody",null,n)))}}]),t}(o.a.Component),M=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={stockSymbol:"",purchaseDate:"",shares:"",hasErrors:!1,errorMessage:"",loading:!1},a.handleOnsubmit=a.handleOnsubmit.bind(Object(p.a)(a)),a.handleOnChange=a.handleOnChange.bind(Object(p.a)(a)),a.handleCancel=a.handleCancel.bind(Object(p.a)(a)),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleOnsubmit",value:function(e){var t=this;e.preventDefault();var a=this.state.stockSymbol,n=this.state.purchaseDate,o=this.state.shares;console.log("==> Adding stock '"+a+"'");var r=null;this.setState({loading:!0},(function(){t.puchasePriceFetcher(a,n).then((function(e){t.state.hasErrors||(r=e,t.props.onAdd(a,n,r,o)),t.setState({hasErrors:!1,loading:!1})}))}))}},{key:"handleOnChange",value:function(e){"stockSymbol"===e.target.name&&this.setState({stockSymbol:e.target.value.toUpperCase()}),"purchaseDate"===e.target.name&&this.setState({purchaseDate:e.target.value}),"shares"===e.target.name&&this.setState({shares:e.target.value})}},{key:"handleCancel",value:function(){this.setState({stockSymbol:"",purchaseDate:"",stockError:"",dateError:""}),this.props.onCancel()}},{key:"render",value:function(){return this.props.show?this.state.loading?o.a.createElement("p",null,"Loading ..."):o.a.createElement("div",null,o.a.createElement("p",null,"Modal visible"),o.a.createElement("form",{onSubmit:this.handleOnsubmit},o.a.createElement("label",null,"Stock symbol",o.a.createElement("input",{type:"text",name:"stockSymbol",value:this.state.stockSymbol,onChange:this.handleOnChange,required:!0})),o.a.createElement("label",null,"Date of purchase",o.a.createElement("input",{type:"date",name:"purchaseDate",value:this.state.purchaseDate,onChange:this.handleOnChange,required:!0})),o.a.createElement("label",null,"Number of shares",o.a.createElement("input",{type:"number",min:"1",name:"shares",value:this.state.shares,onChange:this.handleOnChange,required:!0})),o.a.createElement("input",{type:"submit",value:"Add"})),o.a.createElement("p",null,this.state.errorMessage),o.a.createElement("button",{onClick:this.handleCancel},"Cancel")):o.a.createElement("p",null,"Modal hidden")}},{key:"puchasePriceFetcher",value:function(e,t){var a=this,n=t.replace(/-/g,""),o=k(e,n);return fetch(o).then((function(e){if(e.ok)return e.json();throw 404===e.status?new Error("Unknown stock symbol"):new Error("Error while fetching from api ...")})).then((function(e){if(e.length>0)return e[0].close;throw new Error("No available stock data for that date. Either the exchange was closed that day (e.g. weekend) or the date is too far in the past.")})).catch((function(e){console.log("==>",e.message),a.setState({hasErrors:!0,errorMessage:e.message})}))}}]),t}(o.a.Component),x=[{value:"5d",text:"5 days"},{value:"1m",text:"1 month"},{value:"3m",text:"3 months"},{value:"6m",text:"6 months"},{value:"ytd",text:"This year"},{value:"1y",text:"1 year"},{value:"2y",text:"2 years"},{value:"5y",text:"5 years"},{value:"max",text:"Maximum available"}],U=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={showAddStockModal:!1},a.handleToggleShowInEuro=a.handleToggleShowInEuro.bind(Object(p.a)(a)),a.handleOnUpdate=a.handleOnUpdate.bind(Object(p.a)(a)),a.handleToggleShowAddStockModal=a.handleToggleShowAddStockModal.bind(Object(p.a)(a)),a.handleAddStock=a.handleAddStock.bind(Object(p.a)(a)),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"handleToggleShowInEuro",value:function(e){this.props.onToggleShowInEuro(e)}},{key:"handleOnUpdate",value:function(e){this.props.onUpdate(e.target.name)}},{key:"handleToggleShowAddStockModal",value:function(){this.setState({showAddStockModal:!this.state.showAddStockModal})}},{key:"handleAddStock",value:function(e,t,a,n){this.handleToggleShowAddStockModal(),this.props.onAddStock(this.props.name,e,t,a,n)}},{key:"render",value:function(){if("undefined"===typeof this.props.name||"undefined"===typeof this.props.portfolio||"undefined"===typeof this.props.portfolio.userPrefs)return o.a.createElement("p",null,"Loading ...");var e=this.props.name,t=this.props.portfolio,a=this.props.isUpdating,n=t.stocks,r=t.userPrefs.showInEuro,l=t.userPrefs.graphRange;return o.a.createElement("div",null,o.a.createElement("h2",null,e),o.a.createElement("button",{name:e,onClick:this.handleToggleShowInEuro},r?"USD":"EUR"),o.a.createElement("button",{name:e,onClick:this.handleOnUpdate},a?"Fetching ...":"Update"),o.a.createElement("div",null,o.a.createElement(C,{stocks:n,graphRange:l,showInEuro:r,euroPerUsd:.9}),o.a.createElement("select",{defaultValue:l},x.map((function(e){return o.a.createElement("option",{key:e.value,value:e.value},e.value)})))),o.a.createElement("button",{onClick:this.handleToggleShowAddStockModal},"Add stock"),o.a.createElement(M,{show:this.state.showAddStockModal,onCancel:this.handleToggleShowAddStockModal,onAdd:this.handleAddStock},'"I am a child of this modal"'),o.a.createElement(A,{stocks:n,showInEuro:r,euroPerUsd:.9}),o.a.createElement("button",null,"Remove portfolio"))}}]),t}(o.a.Component);function I(e,t,a){var n=Object.keys(e)[0],o={};o.companyName=e[n].quote.companyName,o.latestPrice=e[n].quote.latestPrice;var r={},l=e[n].chart;for(var s in l)l.hasOwnProperty(s)&&(r[s]={date:l[s].date,close:l[s].close});return t[a].stocks[n].quote=o,t[a].stocks[n].chart=r,t}var R={showInEuro:!1,graphRange:"6m"},T=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={appData:{},showAddPortfolioModal:!1,loading:!1,isUpdating:!1},a.toggleShowAddPortfolioModal=a.toggleShowAddPortfolioModal.bind(Object(p.a)(a)),a.handleAddPortfolio=a.handleAddPortfolio.bind(Object(p.a)(a)),a.handleAddStock=a.handleAddStock.bind(Object(p.a)(a)),a.handleOnUpdate=a.handleOnUpdate.bind(Object(p.a)(a)),a.handleToggleShowInEuro=a.handleToggleShowInEuro.bind(Object(p.a)(a)),a}return Object(m.a)(t,e),Object(h.a)(t,[{key:"dataFetcher",value:function(e,t,a){var n=this,o=b(e,t,a);return fetch(o).then((function(e){if(e.ok)return e.json();throw new Error("Error while fetching from api...")})).then((function(e){return e})).catch((function(e){return n.setState({error:e})}))}},{key:"puchasePriceFetcher",value:function(e,t){var a=this,n=k(e,t);return fetch(n).then((function(e){if(e.ok)return e.json();throw new Error("Error while fetching from api...")})).then((function(e){return e[0].close})).catch((function(e){return a.setState({error:e})}))}},{key:"createAndAppendDummyPortfolio",value:function(e,t,a,n){var o=this;console.log("==> Creating dummy portfolio '"+e+"'"),this.dataFetcher(t,a,n).then((function(t){for(var a in t)t.hasOwnProperty(a)&&(t[a].purchase={date:"1970-01-01",price:10,shares:7,currency:"USD"});var n=o.state.appData;n[e]={stocks:t},n[e].userPrefs={showInEuro:!1,graphRange:"6m"},o.setState({appData:n},(function(){console.log("==> State set. Dummy purchase data added to"+e),S(o.state.appData,"appData")}))}))}},{key:"refreshPortfolio",value:function(e){var t=this;console.log("==> Refreshing portfolio data '"+e+"'");var a=this.state.appData,n=Object.keys(a[e].stocks);this.dataFetcher(n,"quote,chart","5d").then((function(n){for(var o in n)n.hasOwnProperty(o)&&(a[e].stocks[o].chart=n[o].chart);console.log("==> Refreshed portfolio:",a[e]),t.setState({appData:a},(function(){console.log("==> Set state with newStockData and range 5d !!!!!!!!!!!!!!!!"),S(t.state.appData,"appData")}))}))}},{key:"componentDidMount",value:function(){var e=this;console.log("==> componentDidLoad");try{var t=w("appData");this.setState({appData:t},(function(){console.log("==> State set. Loaded 'portfolios' and 'appData' from local storage"),console.log("==> appData:",e.state.appData)}))}catch(a){console.log("==>",a)}}},{key:"toggleShowAddPortfolioModal",value:function(){this.setState({showAddPortfolioModal:!this.state.showAddPortfolioModal})}},{key:"handleAddPortfolio",value:function(e){var t=this;this.toggleShowAddPortfolioModal(),console.log("==> Creating new portfolio '"+e+"'");var a=this.state.appData;a[e]={userPrefs:R},a[e].stocks={},this.setState({appData:a},(function(){console.log("==> Created new portfolio '"+e+"'"),S(t.state.appData,"appData")}))}},{key:"handleAddStock",value:function(e,t,a,n,o){var r=this;console.log("==> Adding stock to",e,t,a,n,o);var l=E(a);this.dataFetcher([t],"quote,chart",l).then((function(t){var l=r.state.appData;l=function(e,t,a,n,o,r){var l=Object.keys(e)[0],s={};s.companyName=e[l].quote.companyName,s.latestPrice=e[l].quote.latestPrice;var c={},i=e[l].chart;for(var h in i)i.hasOwnProperty(h)&&(c[h]={date:i[h].date,close:i[h].close});var u={date:n,price:o,shares:r,currency:"USD"};return t[a].stocks[l]={quote:s,chart:c,purchase:u},t}(t,l,e,a,n,o),r.setState({appData:l},(function(){console.log("==> State set. Stock data added to '"+e+"'"),S(r.state.appData,"appData")}))}))}},{key:"handleOnUpdate",value:function(e){var t,a,n,o,r;return c.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:console.log("==> Updating '"+e+"'"),this.setState({isUpdating:!0}),t=this.state.appData,a=t[e].stocks,l.t0=c.a.keys(a);case 5:if((l.t1=l.t0()).done){l.next=16;break}if(n=l.t1.value,!a.hasOwnProperty(n)){l.next=14;break}return console.log(n),o=E(a[n].purchase.date),"quote,chart",r=this.dataFetcher([n],"quote,chart",o),l.next=14,c.a.awrap(r.then((function(a){console.log("then"),t=I(a,t,e)})));case 14:l.next=5;break;case 16:this.setState({appData:t,isUpdating:!1},(function(){console.log("==> Portfolio '"+e+"' updated",t),S(t,"appData")}));case 17:case"end":return l.stop()}}),null,this)}},{key:"handleToggleShowInEuro",value:function(e){var t=e.target.name,a=this.state.appData;a[t].userPrefs.showInEuro=!a[t].userPrefs.showInEuro,this.setState({appData:a})}},{key:"render",value:function(){var e=this;console.log("==> App render");var t=this.state.appData,a=[];for(var n in t)t.hasOwnProperty(n)&&a.push(n);return o.a.createElement("div",{className:"App"},o.a.createElement("h1",null,"SPMS"),o.a.createElement("a",{href:"https://iexcloud.io"},"Data provided by IEX Cloud"),o.a.createElement("p",null,"15 minute delay in price"),o.a.createElement("button",{onClick:this.toggleShowAddPortfolioModal},"Add portfolio"),o.a.createElement(O,{show:this.state.showAddPortfolioModal,onCancel:this.toggleShowAddPortfolioModal,onAdd:this.handleAddPortfolio,portfolios:a},'"We are the children of this modal"'),a.map((function(a){return o.a.createElement(U,{key:a,name:a,portfolio:t[a],isUpdating:e.state.isUpdating,onToggleShowInEuro:e.handleToggleShowInEuro,onUpdate:e.handleOnUpdate,onAddStock:e.handleAddStock})})))}}]),t}(o.a.Component);l.a.render(o.a.createElement(T,null),document.getElementById("root"))}},[[180,1,2]]]);
//# sourceMappingURL=main.fe7195cd.chunk.js.map