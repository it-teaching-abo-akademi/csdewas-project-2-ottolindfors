(this["webpackJsonpmy-react-app"]=this["webpackJsonpmy-react-app"]||[]).push([[0],{181:function(e,t,a){e.exports=a(372)},186:function(e,t,a){},188:function(e,t,a){},372:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(34),l=a.n(r),s=(a(186),a(15)),c=a(29),i=a.n(c),h=a(10),d=a(11),u=a(13),p=a(12),m=a(6),f=a(14),g=(a(188),"Tpk_564e31a7cc054b8c87a93c668202adce"),v="https://sandbox.iexapis.com/stable/stock/market/batch?",b="https://sandbox.iexapis.com/stable/stock/";var k=function(e,t,a){return function(e,t,a){var n=v;n+="symbols=";for(var o=0;o<e.length;o++)n+=e[o],o<e.length-1&&(n+=",");return n+="&types="+t,t.includes("chart")&&(n+=a?"&range="+a:"&range=1y"),n+="&token="+g}(e,t,a)},E=function(e,t){return function(e,t){var a=b;return a+=e,a+="/chart/date/",a+=t,a+="?chartByDay=true&token=",a+=g}(e,t)};function O(e){for(var t=new Date(e),a=new Date,n=Math.ceil((a-t)/864e5),o=new Date((new Date).toISOString().slice(0,4)),r=Math.ceil((a-o)/864e5),l=["5d","1m","3m","6m","1y","2y","5y"],s=[5,32,94,168,367,732,1828],c="",i=0,h=!0;h;)n<=s[i]?(c=r>=n&&r<=s[i]?"ytd":l[i],h=!1):i===s.length&&(c="max",h=!1),i++;return c}function w(e,t){return e.name<t.name?-1:e.name>t.name?1:0}var y=function(e){return function(e){var t=JSON.parse(localStorage.getItem(e));if(!t)throw new Error("Did not find '"+e+"' in local storage");return t}(e)},S=function(e,t){return function(e,t){localStorage.setItem(t,JSON.stringify(e)),console.log("==> Saved to local storage '"+t+"'")}(e,t)},C=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={newPortfolioName:"",inputError:"",submitError:""},a.handleOnSubmit=a.handleOnSubmit.bind(Object(m.a)(a)),a.handleOnChange=a.handleOnChange.bind(Object(m.a)(a)),a.handleOnCancel=a.handleOnCancel.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"handleOnSubmit",value:function(e){e.preventDefault();var t=this.props.portfolios,a=this.state.newPortfolioName;t.includes(a)?this.setState({submitError:"Pick another name for your portfolio"}):(this.setState({newPortfolioName:"",submitError:""}),this.props.onAdd(a))}},{key:"handleOnChange",value:function(e){var t=this.props.portfolios,a=e.target.value;t.includes(a)?this.setState({newPortfolioName:e.target.value,inputError:"You have another portfolio with this name"}):this.setState({newPortfolioName:e.target.value,inputError:"",submitError:""})}},{key:"handleOnCancel",value:function(){this.setState({newPortfolioName:"",inputError:"",submitError:""}),this.props.onCancel()}},{key:"render",value:function(){return this.props.show?o.a.createElement("div",null,o.a.createElement("h2",null,"Add a new portfolio"),o.a.createElement("form",{onSubmit:this.handleOnSubmit},o.a.createElement("label",null,"Portfolio name",o.a.createElement("input",{type:"text",value:this.state.newPortfolioName,onChange:this.handleOnChange,required:!0})),o.a.createElement("p",null,this.state.inputError),o.a.createElement("p",null,this.state.submitError),o.a.createElement("input",{type:"submit",value:"Add"}),o.a.createElement("button",{onClick:this.handleOnCancel},"Cancel"))):null}}]),t}(o.a.Component),D=a(22),P=function(e){function t(){return Object(h.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(d.a)(t,[{key:"generateHslColor",value:function(){return"hsl("+(360*Math.random()).toFixed(0).toString()+",40%,70%)"}},{key:"graphRangeToDate",value:function(e){if(e.includes("d")&&!e.includes("ytd")){var t=e.replace("d",""),a=new Date;return new Date((new Date).setDate(a.getDate()-t))}if(e.includes("m")&&!e.includes("max")){var n=e.replace("m",""),o=new Date;return new Date((new Date).setMonth(o.getMonth()-n))}if(e.includes("ytd"))return new Date((new Date).toISOString().slice(0,4));if(e.includes("y")&&!e.includes("ytd")){var r=e.replace("y",""),l=new Date;return new Date((new Date).setFullYear(l.getFullYear()-r))}if(e.includes("max")){var s=new Date;return new Date((new Date).setFullYear(s.getFullYear()-15))}}},{key:"render",value:function(){var e=this,t=this.props.stocks,a=this.props.graphRange,n=this.props.showInEuro,r=this.props.euroPerUsd,l=[],s=[],c=[],i=this.graphRangeToDate(a);for(var h in t)if(t.hasOwnProperty(h)){c.push(h);var d=t[h].chart;for(var u in d)if(d.hasOwnProperty(u)){var p=0;p=n?Number((d[u].close*r).toFixed(2)):d[u].close;var m=d[u].date;if(new Date(m)>=i)if(s.includes(m)){var f=s.indexOf(m),g=l[f];g[h]=p,l[f]=g}else{s.push(m);var v={};v.name=m,v[h]=p,l.push(v)}}}return l.sort(w),o.a.createElement("div",null,o.a.createElement(D.e,{aspect:1.7,width:500},o.a.createElement(D.d,{width:"100%",height:"100%",data:l},o.a.createElement(D.a,{strokeDasharray:"1 3"}),o.a.createElement(D.g,{dataKey:"name"}),o.a.createElement(D.h,null),o.a.createElement(D.f,null),o.a.createElement(D.b,null),c.map((function(t){return o.a.createElement(D.c,{key:t,dataKey:t,stroke:e.generateHslColor(),activeDot:{r:4},dot:!1})})))))}}]),t}(o.a.PureComponent),j=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).handleCheckedChange=a.handleCheckedChange.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"handleCheckedChange",value:function(e){this.props.onRowCheckedChange(e)}},{key:"render",value:function(){var e=this.props.stock,t=this.props.stockInfo,a=this.props.showInEuro,n=this.props.euroPerUsd,r=this.props.isChecked,l=t.quote.latestPrice,s=t.purchase.shares,c=t.purchase.price,i=t.purchase.currency;return o.a.createElement("tr",null,o.a.createElement("td",null,e),o.a.createElement("td",null,a?(l*n).toFixed(2)+" EUR":l+" USD"),o.a.createElement("td",null,c," ",i),o.a.createElement("td",null,s),o.a.createElement("td",null,a?(l*s*n).toFixed(2)+" EUR":(l*s).toFixed(2)+" USD"),o.a.createElement("td",null,o.a.createElement("input",{name:e,type:"checkbox",checked:r,onChange:this.handleCheckedChange})))}}]),t}(o.a.Component),R=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={selectedRows:[]},a.handleRowCheckedChange=a.handleRowCheckedChange.bind(Object(m.a)(a)),a.handleOnClick=a.handleOnClick.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.stocks,t=[];for(var a in e)e.hasOwnProperty(a)&&(t[a]=!1);this.setState({selectedRows:t})}},{key:"handleRowCheckedChange",value:function(e){var t=e.target.name,a=e.target.checked,n=this.state.selectedRows;n[t]=a,this.setState({selectedRows:n})}},{key:"handleOnClick",value:function(){this.props.onRemoveSelected(this.state.selectedRows)}},{key:"render",value:function(){var e=this.props.stocks,t=this.props.showInEuro,a=this.props.euroPerUsd,n=this.state.selectedRows,r=[];for(var l in e)e.hasOwnProperty(l)&&r.push(o.a.createElement(j,{key:l,stock:l,stockInfo:e[l],showInEuro:t,euroPerUsd:a,isChecked:0!==Object.keys(n).length&&n[l],onRowCheckedChange:this.handleRowCheckedChange}));return o.a.createElement("div",null,o.a.createElement("button",{onClick:this.handleOnClick},"Remove selected"),o.a.createElement("table",null,o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,"Stock"),o.a.createElement("th",null,"Latest Price"),o.a.createElement("th",null,"Purchase Price"),o.a.createElement("th",null,"Shares"),o.a.createElement("th",null,"Total"),o.a.createElement("th",null,"Select"))),o.a.createElement("tbody",null,r)))}}]),t}(o.a.Component),A=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={stockSymbol:"",purchaseDate:"",shares:"",hasErrors:!1,errorMessage:"",loading:!1},a.handleOnsubmit=a.handleOnsubmit.bind(Object(m.a)(a)),a.handleOnChange=a.handleOnChange.bind(Object(m.a)(a)),a.handleCancel=a.handleCancel.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"handleOnsubmit",value:function(e){var t=this;e.preventDefault();var a=this.state.stockSymbol,n=this.state.purchaseDate,o=this.state.shares,r=null;this.setState({loading:!0},(function(){t.puchasePriceFetcher(a,n).then((function(e){t.state.hasErrors||(r=e,t.props.onAdd(a,n,r,o)),t.setState({hasErrors:!1,loading:!1})}))}))}},{key:"handleOnChange",value:function(e){"stockSymbol"===e.target.name&&this.setState({stockSymbol:e.target.value.toUpperCase()}),"purchaseDate"===e.target.name&&this.setState({purchaseDate:e.target.value}),"shares"===e.target.name&&this.setState({shares:e.target.value})}},{key:"handleCancel",value:function(){this.setState({stockSymbol:"",purchaseDate:"",stockError:"",dateError:""}),this.props.onCancel()}},{key:"render",value:function(){return this.props.show?this.state.loading?o.a.createElement("p",null,"Loading ..."):o.a.createElement("div",null,o.a.createElement("h3",null,"Add stock"),o.a.createElement("form",{onSubmit:this.handleOnsubmit},o.a.createElement("label",null,"Stock symbol",o.a.createElement("input",{type:"text",name:"stockSymbol",value:this.state.stockSymbol,onChange:this.handleOnChange,required:!0})),o.a.createElement("label",null,"Date of purchase",o.a.createElement("input",{type:"date",name:"purchaseDate",value:this.state.purchaseDate,onChange:this.handleOnChange,required:!0})),o.a.createElement("label",null,"Number of shares",o.a.createElement("input",{type:"number",min:"1",name:"shares",value:this.state.shares,onChange:this.handleOnChange,required:!0})),o.a.createElement("input",{type:"submit",value:"Add"})),o.a.createElement("p",null,this.state.errorMessage),o.a.createElement("button",{onClick:this.handleCancel},"Cancel")):null}},{key:"puchasePriceFetcher",value:function(e,t){var a=this,n=t.replace(/-/g,""),o=E(e,n);return fetch(o).then((function(e){if(e.ok)return e.json();throw 404===e.status?new Error("Unknown stock symbol"):new Error("Error while fetching from api ...")})).then((function(e){if(e.length>0)return e[0].close;throw new Error("No available stock data for that date. Either the exchange was closed that day (e.g. weekend) or the date is too far in the past.")})).catch((function(e){console.log("==>",e.message),a.setState({hasErrors:!0,errorMessage:e.message})}))}}]),t}(o.a.Component),x=[{value:"5d",text:"5 days"},{value:"1m",text:"1 month"},{value:"3m",text:"3 months"},{value:"6m",text:"6 months"},{value:"ytd",text:"This year"},{value:"1y",text:"1 year"},{value:"2y",text:"2 years"},{value:"5y",text:"5 years"},{value:"max",text:"Maximum available"}],U=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={showAddStockModal:!1},a.handleToggleShowInEuro=a.handleToggleShowInEuro.bind(Object(m.a)(a)),a.handleOnUpdate=a.handleOnUpdate.bind(Object(m.a)(a)),a.handleOnGraphRangeChange=a.handleOnGraphRangeChange.bind(Object(m.a)(a)),a.handleToggleShowAddStockModal=a.handleToggleShowAddStockModal.bind(Object(m.a)(a)),a.handleAddStock=a.handleAddStock.bind(Object(m.a)(a)),a.handleOnRemoveSelected=a.handleOnRemoveSelected.bind(Object(m.a)(a)),a.handleRemovePortfolio=a.handleRemovePortfolio.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"handleToggleShowInEuro",value:function(e){this.props.onToggleShowInEuro(e)}},{key:"handleOnUpdate",value:function(e){this.props.onUpdate(e.target.name)}},{key:"handleOnGraphRangeChange",value:function(e){this.props.onGraphRangeChange(this.props.name,e.target.value)}},{key:"handleToggleShowAddStockModal",value:function(){this.setState({showAddStockModal:!this.state.showAddStockModal})}},{key:"handleAddStock",value:function(e,t,a,n){this.handleToggleShowAddStockModal(),this.props.onAddStock(this.props.name,e,t,a,n)}},{key:"handleOnRemoveSelected",value:function(e){this.props.onRemoveSelected(this.props.name,e)}},{key:"handleRemovePortfolio",value:function(){this.props.onRemovePortfolio(this.props.name)}},{key:"render",value:function(){if("undefined"===typeof this.props.name||"undefined"===typeof this.props.portfolio||"undefined"===typeof this.props.portfolio.userPrefs)return o.a.createElement("p",null,"Loading ...");var e=this.props.name,t=this.props.portfolio,a=this.props.isUpdating,n=t.stocks,r=t.userPrefs.showInEuro,l=t.userPrefs.graphRange;return o.a.createElement("div",null,o.a.createElement("h2",null,e),o.a.createElement("button",{name:e,onClick:this.handleToggleShowInEuro},r?"USD":"EUR"),o.a.createElement("button",{name:e,onClick:this.handleOnUpdate},a?"Fetching ...":"Update"),o.a.createElement("div",null,o.a.createElement(P,{stocks:n,graphRange:l,showInEuro:r,euroPerUsd:.9}),o.a.createElement("select",{defaultValue:l,onChange:this.handleOnGraphRangeChange},x.map((function(e){return o.a.createElement("option",{key:e.value,value:e.value},e.value)})))),o.a.createElement("button",{onClick:this.handleToggleShowAddStockModal},"Add stock"),o.a.createElement(A,{show:this.state.showAddStockModal,onCancel:this.handleToggleShowAddStockModal,onAdd:this.handleAddStock},'"I am a child of this modal"'),o.a.createElement(R,{stocks:n,showInEuro:r,euroPerUsd:.9,onRemoveSelected:this.handleOnRemoveSelected}),o.a.createElement("button",{onClick:this.handleRemovePortfolio},"Remove portfolio"))}}]),t}(o.a.Component);function M(e,t,a){var n=Object.keys(e)[0],o={};o.companyName=e[n].quote.companyName,o.latestPrice=e[n].quote.latestPrice;var r={},l=e[n].chart;for(var s in l)l.hasOwnProperty(s)&&(r[s]={date:l[s].date,close:l[s].close});return t[a].stocks[n].quote=o,t[a].stocks[n].chart=r,t}var I={showInEuro:!1,graphRange:"6m"},T=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={appData:{},showAddPortfolioModal:!1,loading:!1,isUpdating:!1},a.toggleShowAddPortfolioModal=a.toggleShowAddPortfolioModal.bind(Object(m.a)(a)),a.handleAddPortfolio=a.handleAddPortfolio.bind(Object(m.a)(a)),a.handleAddStock=a.handleAddStock.bind(Object(m.a)(a)),a.handleOnUpdate=a.handleOnUpdate.bind(Object(m.a)(a)),a.handleOnGraphRangeChange=a.handleOnGraphRangeChange.bind(Object(m.a)(a)),a.handleToggleShowInEuro=a.handleToggleShowInEuro.bind(Object(m.a)(a)),a.handleRemoveSelected=a.handleRemoveSelected.bind(Object(m.a)(a)),a.handleOnRemovePortfolio=a.handleOnRemovePortfolio.bind(Object(m.a)(a)),a}return Object(f.a)(t,e),Object(d.a)(t,[{key:"dataFetcher",value:function(e,t,a){var n=this,o=k(e,t,a);return fetch(o).then((function(e){if(e.ok)return e.json();throw new Error("Error while fetching from api...")})).then((function(e){return e})).catch((function(e){return n.setState({error:e})}))}},{key:"puchasePriceFetcher",value:function(e,t){var a=this,n=E(e,t);return fetch(n).then((function(e){if(e.ok)return e.json();throw new Error("Error while fetching from api...")})).then((function(e){return e[0].close})).catch((function(e){return a.setState({error:e})}))}},{key:"componentDidMount",value:function(){console.log("==> componentDidLoad");try{var e=y("appData");this.setState({appData:e},(function(){return console.log("==> Loaded 'portfolios' and 'appData' from local storage")}))}catch(t){console.log("==>",t)}}},{key:"toggleShowAddPortfolioModal",value:function(){this.setState({showAddPortfolioModal:!this.state.showAddPortfolioModal})}},{key:"handleAddPortfolio",value:function(e){var t=this;this.toggleShowAddPortfolioModal();var a=this.state.appData;a[e]={userPrefs:I},a[e].stocks={},this.setState({appData:a},(function(){console.log("==> Created new portfolio '"+e+"'"),S(t.state.appData,"appData")}))}},{key:"handleAddStock",value:function(e,t,a,n,o){var r=this;console.log("==> Adding stock to",e,t,a,n,o);var l=O(a);console.log("DEBUG: chart range to fetch from API:",l);this.dataFetcher([t],"quote,chart",l).then((function(t){var l=r.state.appData;l=function(e,t,a,n,o,r){var l=Object.keys(e)[0],s={};s.companyName=e[l].quote.companyName,s.latestPrice=e[l].quote.latestPrice;var c={},i=e[l].chart;for(var h in i)i.hasOwnProperty(h)&&(c[h]={date:i[h].date,close:i[h].close});var d={date:n,price:o,shares:r,currency:"USD"};return t[a].stocks[l]={quote:s,chart:c,purchase:d},t}(t,l,e,a,n,o),r.setState({appData:l},(function(){console.log("==> Stock data added to '"+e+"'"),S(r.state.appData,"appData")}))}))}},{key:"handleOnUpdate",value:function(e){var t,a,n,o,r;return i.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:console.log("==> Updating '"+e+"'"),this.setState({isUpdating:!0}),t=this.state.appData,a=t[e].stocks,l.t0=i.a.keys(a);case 5:if((l.t1=l.t0()).done){l.next=15;break}if(n=l.t1.value,!a.hasOwnProperty(n)){l.next=13;break}return o=O(a[n].purchase.date),"quote,chart",r=this.dataFetcher([n],"quote,chart",o),l.next=13,i.a.awrap(r.then((function(a){t=M(a,t,e)})));case 13:l.next=5;break;case 15:this.setState({appData:t,isUpdating:!1},(function(){console.log("==> Updated portfolio '"+e+"'"),S(t,"appData")}));case 16:case"end":return l.stop()}}),null,this)}},{key:"handleOnGraphRangeChange",value:function(e,t){var a=this.state.appData;a[e].userPrefs.graphRange=t,this.setState({appData:a},(function(){return S(a,"appData")}))}},{key:"handleToggleShowInEuro",value:function(e){var t=e.target.name,a=this.state.appData;a[t].userPrefs.showInEuro=!a[t].userPrefs.showInEuro,this.setState({appData:a},(function(){return S(a,"appData")}))}},{key:"handleRemoveSelected",value:function(e,t){for(var a=this.state.appData,n=0,o=Object.entries(t);n<o.length;n++){var r=o[n],l=Object(s.a)(r,2),c=l[0];l[1]&&delete a[e].stocks[c]}this.setState({appData:a},(function(){console.log("==> Deleted selected stocks from '"+e+"'"),S(a,"appData")}))}},{key:"handleOnRemovePortfolio",value:function(e){var t=this.state.appData;delete t[e],this.setState({appData:t},(function(){console.log("==> Deleted portfolio '"+e+"'"),S(t,"appData")}))}},{key:"render",value:function(){var e=this;console.log("==> App render");var t=this.state.appData,a=[];for(var n in t)t.hasOwnProperty(n)&&a.push(n);return o.a.createElement("div",{className:"App"},o.a.createElement("h1",null,"SPMS"),o.a.createElement("p",null,o.a.createElement("a",{href:"https://iexcloud.io"},"Data provided by IEX Cloud"),". 15 minute delay in price."),o.a.createElement("p",null,"This app is a work in progress."),o.a.createElement("p",null,"Known issues: The graph does not update when a stock is added (manual refresh by user is needed)."),o.a.createElement("button",{onClick:this.toggleShowAddPortfolioModal},"Add portfolio"),o.a.createElement(C,{show:this.state.showAddPortfolioModal,onCancel:this.toggleShowAddPortfolioModal,onAdd:this.handleAddPortfolio,portfolios:a},'"We are the children of this modal"'),a.map((function(a){return o.a.createElement(U,{key:a,name:a,portfolio:t[a],isUpdating:e.state.isUpdating,onToggleShowInEuro:e.handleToggleShowInEuro,onUpdate:e.handleOnUpdate,onGraphRangeChange:e.handleOnGraphRangeChange,onAddStock:e.handleAddStock,onRemoveSelected:e.handleRemoveSelected,onRemovePortfolio:e.handleOnRemovePortfolio})})))}}]),t}(o.a.Component);l.a.render(o.a.createElement(T,null),document.getElementById("root"))}},[[181,1,2]]]);
//# sourceMappingURL=main.083342e7.chunk.js.map